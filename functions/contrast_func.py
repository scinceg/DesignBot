from telebot import types

# –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤
# https://ru.hexlet.io/blog/posts/chto-nuzhno-znat-o-kontraste-teksta-i-kak-kontrolirovat-kontrast-s-pomoschyu-sass

global colors, rate
colors = str()
rate = str()

# –ü—Ä–∏–Ω–µ–º–∞–µ—Ç 2 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ü–≤–µ—Ç–∞: —É –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∏—Ö –±–æ–ª—å—à–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —è—Ä–∫–æ—Å—Ç—å
def color_contrast(c1, c2):
    # –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —è—Ä–∫–æ—Å—Ç—å —Å–∞–º–æ–≥–æ —Å–≤–µ—Ç–ª–æ–≥–æ —Ü–≤–µ—Ç–∞
    l1 = color_brightness(c1[0], c1[1], c1[2])
    # –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —è—Ä–∫–æ—Å—Ç—å —Å–∞–º–æ–≥–æ —Ç—ë–º–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    l2 = color_brightness(c2[0], c2[1], c2[2])
    if l1 > l2:
        pass
    else:
        l1, l2 = l2, l1
    # –°–∞–º—ã–π —Å–≤–µ—Ç–ª—ã–π –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —Å–∞–º—ã–π —Ç—ë–º–Ω—ã–π —Ü–≤–µ—Ç
    return (l1 + 0.05) / (l2 + 0.05)

# –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —è—Ä–∫–æ—Å—Ç–∏ –¥–ª—è —Ü–≤–µ—Ç–∞. –ü—Ä–∏–Ω–µ–º–∞–µ—Ç r g b —Ü–≤–µ—Ç–∞
def color_brightness(r, g, b):
    r = r / 255
    g = g / 255
    b = b / 255

    color = [r, g, b]

    # –¢–µ–ª–æ —Ü–∏–∫–ª–∞ –ø—Ä–∏–º–µ–Ω—è—è–µ—Ç—Å—è –¥–ª—è r, g, b
    for i in range(0, len(color)):
            if color[i] <= 0.03928:
                color[i] = color[i] / 12.92
            else:
                color[i] = ((color[i]+0.055)/1.055)**2.4

    l = 0.2126*color[0]+0.7152*color[1]+0.0722*color[2]
    return l

# –ü–µ—Ä–µ–≤–æ–¥ —Ü–≤–µ—Ç–∞ –∏–∑ hex —Ñ–æ—Ä–º–∞—Ç–∞ –≤ rgb
def hex_to_rgb(color):
    # –î–µ–ª–∏–º —Å—Ç—Ä–æ–∫—É —Ü–≤–µ—Ç–∞ –Ω–∞ –ø–∞—Ä—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –≤ –º–∞—Å—Å–∏–≤ rgb
    rgb = [color[0:2], color[2:4], color[4:6]]
    # –ö–∞–∂–¥—É—é –ø–∞—Ä—É –∏–∑ –º–∞—Å—Å–∏–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∏–º –∏–∑ 16-—Ä–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ 10-—Ä–∏—á–Ω—É—é
    for i in range(0, len(rgb)):
        rgb[i] = int(rgb[i], 16)
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ü–≤–µ—Ç –≤ rgb —Ñ–æ—Ä–º–∞—Ç–µ
    return rgb

def contrast(message, bot):
    def func(message):
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–≤–∞ —Ü–≤–µ—Ç–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        colors = message.text
        # –î–µ–ª–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å—Ç–æ–ø —Ñ—É–Ω–∫—Ü–∏–∏
        if colors == "—Å—Ç–æ–ø":
            bot.send_message(message.from_user.id, "–í—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –≤–∞–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.")
            return
        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–¥–µ–ª—å–Ω–æ –∫–∞–∂–¥—ã–π —Ü–≤–µ—Ç. –î–µ–ª–∞–µ–º —Å—Ä–µ–∑ —Å 1 —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç—Ä–æ–∫–∏ —Å1 –∏ —Å—Ä–µ–∑ colors.find(' ')+2: –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç # –≤ –Ω–∞—á–∞–ª–µ
        c1 = colors[1:colors.find(' ')]
        c2 = colors[colors.find(' ')+2:]

        try:
            contrast_index = color_contrast(hex_to_rgb(c1), hex_to_rgb(c2))
        except:
            bot.send_message(message.from_user.id, '–ß—Ç–æ-—Ç–æ –Ω–µ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ü–≤–µ—Ç–∞. ü§î\n –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫–æ–Ω—á–∏—Ç—å, –æ—Ç–ø—Ä–∞–≤—Ç–µ <b>"c—Ç–æ–ø"</b>', parse_mode="html")
            return contrast(message, bot)

        if contrast_index > 12:
            rate = "c—É–ø–µ—Ä! üî•"
        elif contrast_index > 7:
            rate = "—Ö–æ—Ä–æ—à–∏–π üëç"
        elif contrast_index > 4.5:
            rate = "–Ω–µ –æ—á–µ–Ω—å ü§î"
        elif contrast_index > 3:
            rate = "–ø–ª–æ—Ö–æ–π üëé"
        else:
            rate = "–ø–ª–æ—Ö–æ–π üëé"

        bot.send_message(message.from_user.id, f"–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –¥–∞–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤: <b>{round(contrast_index, 2)} –∏–∑ 21.</b> \n –ê –∑–Ω–∞—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞—Å—Ç –º–µ–∂–¥—É –≤–∞—à–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏ - <b>{rate}.</b> \n\n –ù–∞–∂–º–∏ –Ω–∞ <b>'–ö–æ–Ω—Ç—Ä–∞—Å—Ç –º–µ–∂–¥—É —Ü–≤–µ—Ç–∞–º–∏'</b> —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.", parse_mode="html")
    
    mesg = bot.send_message(message.from_user.id, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞. –û—Ç–ø—Ä–∞–≤—Ç–µ –¥–≤–∞ —Ü–≤–µ—Ç–∞ –≤ hex —Ñ–æ—Ä–º–∞—Ç–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª –∏ —è –≤–∞–º —Å–∫–∞–∂—É –Ω–∞ —Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç. \n\n <b>–ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–Ω—ã–π –∏ –±–µ–ª—ã–π: ‚ö´#000000 ‚ö™#FFFFFF</b>", parse_mode="html")
    bot.register_next_step_handler(mesg, func)